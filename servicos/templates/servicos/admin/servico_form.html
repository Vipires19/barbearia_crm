{% extends 'servicos/admin/base_admin.html' %}

{% block title %}{% if is_edit %}Editar Serviço{% else %}Criar Serviço{% endif %} - Admin Barbearia{% endblock %}

{% block content %}
<div class="admin-content-header">
    <h1>
        <i class="fas fa-{% if is_edit %}edit{% else %}plus{% endif %} me-3"></i>
        {% if is_edit %}Editar Serviço{% else %}Criar Novo Serviço{% endif %}
    </h1>
    <p>{% if is_edit %}Edite as informações do serviço{% else %}Preencha as informações do novo serviço{% endif %}</p>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Informações do Serviço
                </h5>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Nome do Serviço *</label>
                                <input type="text" class="form-control" name="nome" 
                                       value="{% if servico %}{{ servico.nome }}{% endif %}" required en>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Categoria *</label>
                                <input type="text" class="form-control" name="categoria" 
                                       value="{% if servico %}{{ servico.categoria }}{% endif %}" required
                                       placeholder="Ex: Corte de Cabelo, Barba, etc.">
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Descrição</label>
                        <textarea class="form-control" name="descricao" rows="3" 
                                  placeholder="Descreva o serviço oferecido...">{% if servico %}{{ servico.descricao }}{% endif %}</textarea>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Preço *</label>
                                <div class="input-group">
                                    <span class="input-group-text">R$</span>
                                    <input type="number" class="form-control" name="preco" 
                                           value="{% if servico %}{{ servico.preco }}{% endif %}" 
                                           step="0.01" min="0" required>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Duração (minutos) *</label>
                                <select class="form-control" name="duracao_minutos" required>
                                    <option value="">Selecione a duração</option>
                                    <option value="15" {% if servico and servico.duracao_minutos == 15 %}selected{% endif %}>15 minutos</option>
                                    <option value="30" {% if servico and servico.duracao_minutos == 30 %}selected{% endif %}>30 minutos</option>
                                    <option value="45" {% if servico and servico.duracao_minutos == 45 %}selected{% endif %}>45 minutos</option>
                                    <option value="60" {% if servico and servico.duracao_minutos == 60 %}selected{% endif %}>1 hora</option>
                                    <option value="90" {% if servico and servico.duracao_minutos == 90 %}selected{% endif %}>1 hora e 30 minutos</option>
                                    <option value="120" {% if servico and servico.duracao_minutos == 120 %}selected{% endif %}>2 horas</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Imagem do Serviço</label>
                        <input type="file" class="form-control" name="imagem" accept="image/*">
                        {% if servico and servico.imagem %}
                        <div class="mt-2">
                            <small class="text-muted">Imagem atual:</small>
                            <img src="/media/{{ servico.imagem }}" alt="{{ servico.nome }}" 
                                 style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px; margin-left: 10px;">
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'servicos:servicos_admin_list' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Voltar
                        </a>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save me-2"></i>
                            {% if is_edit %}Atualizar Serviço{% else %}Criar Serviço{% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <!-- Preview do Serviço -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-eye me-2"></i>Preview</h5>
            </div>
            <div class="card-body">
                <div class="text-center">
                    <div id="preview-image" class="mb-3">
                        {% if servico and servico.imagem %}
                        <img src="/media/{{ servico.imagem }}" alt="{{ servico.nome }}" 
                             style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px;">
                        {% else %}
                        <div class="d-flex align-items-center justify-content-center" 
                             style="width: 100%; height: 200px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-red)); border-radius: 8px;">
                            <i class="fas fa-cut fa-3x" style="color: var(--pure-white);"></i>
                        </div>
                        {% endif %}
                    </div>
                    
                    <h5 id="preview-nome">{% if servico %}{{ servico.nome }}{% else %}Nome do Serviço{% endif %}</h5>
                    <p id="preview-descricao" class="text-muted">
                        {% if servico %}{{ servico.descricao|default:"Descrição do serviço..." }}{% else %}Descrição do serviço...{% endif %}
                    </p>
                    
                    <div class="row">
                        <div class="col-6">
                            <span class="badge bg-primary" id="preview-categoria">
                                {% if servico %}{{ servico.categoria }}{% else %}Categoria{% endif %}
                            </span>
                        </div>
                        <div class="col-6">
                            <h6 style="color: var(--gold-accent);" id="preview-preco">
                                R$ {% if servico %}{{ servico.preco|floatformat:2 }}{% else %}0,00{% endif %}
                            </h6>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Dicas -->
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Dicas</h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Use nomes descritivos e atrativos
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Adicione uma descrição clara do serviço
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Defina um preço competitivo
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Use imagens de alta qualidade
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check text-success me-2"></i>
                        Organize por categorias
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Preview em tempo real
document.addEventListener('DOMContentLoaded', function() {
    const nomeInput = document.querySelector('input[name="nome"]');
    const categoriaInput = document.querySelector('input[name="categoria"]');
    const precoInput = document.querySelector('input[name="preco"]');
    const descricaoInput = document.querySelector('textarea[name="descricao"]');
    const imagemInput = document.querySelector('input[name="imagem"]');
    
    // Preview do nome
    nomeInput.addEventListener('input', function() {
        document.getElementById('preview-nome').textContent = this.value || 'Nome do Serviço';
    });
    
    // Preview da categoria
    categoriaInput.addEventListener('input', function() {
        document.getElementById('preview-categoria').textContent = this.value || 'Categoria';
    });
    
    // Preview do preço
    precoInput.addEventListener('input', function() {
        const preco = parseFloat(this.value) || 0;
        document.getElementById('preview-preco').textContent = 'R$ ' + preco.toFixed(2);
    });
    
    // Preview da descrição
    descricaoInput.addEventListener('input', function() {
        document.getElementById('preview-descricao').textContent = this.value || 'Descrição do serviço...';
    });
    
    // Preview da imagem
    imagemInput.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewImage = document.getElementById('preview-image');
                previewImage.innerHTML = `<img src="${e.target.result}" alt="Preview" style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px;">`;
            };
            reader.readAsDataURL(file);
        }
    });
});

// Validação do formulário
document.querySelector('form').addEventListener('submit', function(e) {
    const nome = document.querySelector('input[name="nome"]').value.trim();
    const categoria = document.querySelector('input[name="categoria"]').value.trim();
    const preco = document.querySelector('input[name="preco"]').value;
    const duracao = document.querySelector('select[name="duracao_minutos"]').value;
    
    if (!nome) {
        e.preventDefault();
        alert('Por favor, preencha o nome do serviço.');
        return;
    }
    
    if (!categoria) {
        e.preventDefault();
        alert('Por favor, preencha a categoria do serviço.');
        return;
    }
    
    if (!preco || parseFloat(preco) <= 0) {
        e.preventDefault();
        alert('Por favor, insira um preço válido.');
        return;
    }
    
    if (!duracao) {
        e.preventDefault();
        alert('Por favor, selecione a duração do serviço.');
        return;
    }
});

// Máscara para preço
document.querySelector('input[name="preco"]').addEventListener('input', function() {
    let value = this.value.replace(/\D/g, '');
    if (value) {
        value = (parseInt(value) / 100).toFixed(2);
        this.value = value;
    }
});
</script>
{% endblock %}

